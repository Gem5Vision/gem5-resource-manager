<html>
  <head>
    <title>Find</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous" />
  </head>

  <body>
    <div class="container">
      <form id="find">
        <input type="text" name="find" id="id" />
        <input type="submit" value="Find" />
      </form>
      <div id="resource" class="col"></div>
      <button type="button" class="btn btn-primary" id="update">Update</button>
    </div>
    <script>
      function print_json(obj) {
        var ul = $('<ul>')
        // add a class to the ul
        ul.addClass('list-group')
        ul.css('display', 'flex')
        ul.css('flex-direction', 'column')
        ul.css('width', '100%')
        for (var i in obj) {
          var li = $('<li>')
          li.addClass('list-group-item')
          // make it flex
          li.css('display', 'flex')
          li.css('align-items', 'center')
          li.css('width', '100%')
          // check if i is int
          if (!Number.isInteger(parseInt(i))) {
            li.append(document.createTextNode(i + ': '))
          }
          if (typeof obj[i] === 'object') {
            li.append(print_json(obj[i]))
          } else {
            let textarea = document.createElement('textarea')
            textarea.innerHTML = obj[i]
            textarea.style.width = '100%'
            li.append(textarea)
          }
      
          ul.append(li)
        }
      
        return ul
      }
      
      function htmlToJson(element) {
        let obj = {}
        // use list if key is empty
        console.log(element.innerText.split(':')[0])
        if (element.innerText.split(':')[0] === '') {
          obj = []
        }
        let children = element.children
        for (let i = 0; i < children.length; i++) {
          if (children[i].children[0].children.length > 0) {
            if (obj[children[i].innerText.split(':')[0]]) {
              if (!Array.isArray(obj[children[i].innerText.split(':')[0]])) {
                obj[children[i].innerText.split(':')[0]] = [obj[children[i].innerText.split(':')[0]]]
              }
              obj[children[i].innerText.split(':')[0]].push(htmlToJson(children[i].children[0]))
              continue
            }
            obj[children[i].innerText.split(':')[0]] = htmlToJson(children[i].children[0])
          } else {
            if (children[i].innerText.split(':')[0] === '') {
              obj.push(children[i].children[0].value)
              continue
            }
            obj[children[i].innerText.split(':')[0]] = children[i].children[0].value
          }
        }
        return obj
      }
      
      document.getElementById('update').addEventListener('click', (e) => {
        e.preventDefault()
        let obj = htmlToJson(document.getElementById('resource').children[0])
        console.log(obj)
      })
      
      document.getElementById('find').addEventListener('submit', (e) => {
        e.preventDefault()
        fetch('/find', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            id: document.getElementById('id').value
          })
        })
          .then((res) => res.json())
          .then((data) => {
            document.getElementById('resource').innerHTML = ''
            let elements = print_json(data)
            // convert to node
            $('#resource').append(elements)
            let obj = htmlToJson(document.getElementById('resource').children[0])
            console.log(obj)
          })
      })
    </script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
  </body>
</html>
